<!DOCTYPE html>
<html>
<head>
<meta charset='UTF-8'>
<title>메인</title>
<link rel="stylesheet"
  href="../../node_modules/bootstrap/dist/css/bootstrap.css">
<link rel="stylesheet" href="../../css/main/main.css">
<link rel="stylesheet" href="../../css/common.css">
<link rel="stylesheet"
  href="../../node_modules/sweetalert/dist/sweetalert.css">
<body>
  <div id="header"></div>
  <div class='container' style='overflow: hidden;'>
   <input type='hidden' id='memberNo'/>
   <input type='hidden' id='email'/>
   <input type='hidden' id='nameback'/>
   <input type='hidden' id='pathback'/>
   <input type='hidden' id='passback'/>
   <input type='hidden' id='facebookback'/>


    <div id='tab'
      style='float: left; width: 150px; height: 700px; margin-left: 10px; margin-right: 20px; position: absoulte;'>
      <ul class="nav nav-pills nav-stacked"
        style='font-family: Noto Sans KR, sans-serif;'>
        <li class="active"><a data-toggle="tab" href="#menu1">초대 확인</a></li>
        <li><a data-toggle="tab" href="#menu2">개인 정보 변경</a></li>
        <li><a data-toggle="tab" href="#menu3" id="menu3_a">로그인 정보 변경 / 페이스북 계정 연동</a></li>
        <li><a data-toggle="tab" href="#menu4">탈퇴</a></li>
      </ul>
    </div>

    <div class="tab-content">
      
        
    <div id="menu1" class="tab-pane fade in active">
      <h2 style=''>초대 확인</h2>
        <hr>
        <div>
        <div id="none" style="display:none;"><h3>받은 초대가 없습니다</h3></div>
        <table id='list-table' class='table table-hover' style='width:750px; overflow:hidden; overflow-y:auto;'>
        <thead>
          <tr>
            <th>모임명</th>
            <th>모임설명</th>
            <th>모임분류</th>
            <th>투표마감일</th>
            <th>수락하기/거절하기</th>
          </tr>
        <thead>
        <tbody></tbody>
      </table>
        </div>
      </div>
      
      <div id="menu2" class="tab-pane fade">
        <h2 style=''>개인 정보 변경</h2>
        <hr>
        <form id="updateform1" method="post" class="form-horizontal"
          action="">
          <div class="form-group"
            style='overflow: hidden; margin-left: 200px;'>
            <img id='now-photo'
              style='float: left; width: 50px; height: 50px;'>
            <div class="file_input_div" style='overflow: hidden;'>
              <input type="file" id='photo' name='files'
                class="file_input_hidden"
                onchange="javascript: document.getElementById('photo-name').value = this.value.replace('C:\\fakepath\\', '')"
                style='float: left;' />
            </div>
            <input id='photo-name' type='text' style='margin-left: 2px;'
              readonly /> <input id='photo-path' type='hidden' />
            <p>
          </div>
          <div class="form-group" style='height:100%; overflow:hidden;'>
            <label class="col-sm-1 control-label" for="username1">이름</label>
            <div class="col-sm-5">
              <input type="text" class="form-control" id="username1"
                name="username1" placeholder="이름" />
            </div>
              <div class="form-group" style='margin-top:90px; margin-left:30px; height:100%; overflow:hidden;'>
                  <button type="submit" class="btn btn-primary" name="update" value="변경하기">변경 하기</button>
              </div>
          </div>
        </form>
      </div>



      <div id="menu3" class="tab-pane fade">
      <h2 style=''>로그인 정보 변경</h2>
        <hr>
        <form id="updateform2" method="post" class="form-horizontal"
          action="">
              <div class="form-group" style='overflow:hidden; white-space:nowrap; '>
                <label class="col-sm-1 control-label" for="email1" style='margin-right:40px;'>이메일</label>
                <div class="col-sm-5">
                  <input type="text" class="form-control" id="email1" name="email1" placeholder="이메일" onChange="isCheck.value='N'" />
                </div>
                  <input type='button' id='emailcheck' value='중복 체크' class="btn btn-success"  style='float:left;'>
                  <input type='hidden' id='isCheck' value="N">
              </div>
              
              
              <div class="form-group" style='margin-left:30px; height:100%; overflow:hidden;'> 
                <label class="col-sm-1 control-label" for="password1" style='margin-right:40px;'>암호</label>
                <div class="col-sm-5">
                  <input type="password" class="form-control" id="password1" name="password1" placeholder="암호" />
                </div>
              </div>

              <div class="form-group" style='height:100%; overflow:hidden; white-space:nowrap; '>
                <label class="col-sm-1 control-label" for="confirm_password1" style='margin-right:40px;'>암호 확인</label>
                <div class="col-sm-5">
                  <input type="password" class="form-control" id="confirm_password1" name="confirm_password1" placeholder="암호 확인" />
                </div>
              </div>
              
               <div class="form-group" style='margin-top:30px; margin-left:30px; height:100%; overflow:hidden;'>
                  <button type="submit" class="btn btn-primary" name="update" value="변경하기">변경 하기</button>
              </div>
        </form>
        
        <hr>
        <h2>페이스북 계정 연동</h2>
        <hr>
        <div id="facebook">
        <a href="#" onclick="fbLogin();"><img src="../../image/fcbkapp.jpg" border="0" alt="" ></a>
        </div>
        <div id="already">
           <h3>이미 페이스북과 연동되어있습니다.</h3>
        </div>
      </div>
      
      <div id="menu4" class="tab-pane fade">
      <h2 style=''>회원탈퇴</h2>
      <h4>회원 탈퇴를 하시려면 이메일 주소와 비밀번호를 한번 더 입력해주세요</h4>
      <hr>
              <div class="form-group" style='overflow:hidden;'>
                <label class="col-sm-2 control-label" for="emailout" >이메일</label>
                  <div class="col-sm-5">
                    <input type="text" class="form-control" id="emailout" name="emailout" placeholder="이메일"/>
                  </div>
                </div>
              
              
              <div class="form-group" style='margin-left:30px; height:100%; overflow:hidden;'> 
                <label class="col-sm-2 control-label" for="passwordout">암호</label>
                <div class="col-sm-5">
                  <input type="password" class="form-control" id="passwordout" name="passwordout" placeholder="암호" />
                </div>
              </div>
              
               <div class="form-group" style='margin-top:90px; margin-left:30px; height:100%; overflow:hidden;'>
                  <button type="button" class="btn btn-primary" name="out" id='out-btn'>탈퇴하기</button>
              </div>
      
      </div>
      
      
      </div>

  </div>
  <div id="footer"></div>
  <script src="../../js/context.js"></script>
  <script src="../../node_modules/jquery/dist/jquery.js"></script>
  <script src="../../node_modules/bootstrap/dist/js/bootstrap.js"></script>
  <script src="../../js/common.js"></script>
  <script src="../../node_modules/sweetalert/dist/sweetalert.min.js"></script>
  <script src="../../node_modules/handlebars/dist/handlebars.js"></script>
  
  <script
    src="../../node_modules/blueimp-file-upload/js/vendor/jquery.ui.widget.js"></script>
  <script src="../../node_modules/blueimp-load-image/js/load-image.js"></script>
  <script
    src="../../node_modules/blueimp-load-image/js/load-image-meta.js"></script>
  <script
    src="../../node_modules/blueimp-load-image/js/load-image-exif.js"></script>
  <script
    src="../../node_modules/blueimp-load-image/js/load-image-exif-map.js"></script>
  <script
    src="../../node_modules/blueimp-load-image/js/load-image-orientation.js"></script>
  <script
    src="../../node_modules/blueimp-canvas-to-blob/js/canvas-to-blob.js"></script>
  <script
    src="../../node_modules/blueimp-file-upload/js/jquery.iframe-transport.js"></script>
  <script
    src="../../node_modules/blueimp-file-upload/js/jquery.fileupload.js"></script>
  <script
    src="../../node_modules/blueimp-file-upload/js/jquery.fileupload-process.js"></script>
  <script
    src="../../node_modules/blueimp-file-upload/js/jquery.fileupload-image.js"></script>

  <script src='main.js'></script>
  <script src='facebook.js'></script>

  <script type="text/javascript"
    src="../../node_modules/jquery-validation/dist/jquery.validate.min.js"></script>
  <script type="text/javascript"
    src="../../node_modules/jquery-validation/dist/additional-methods.min.js"></script>
  <script type="text/javascript"
    src="../../node_modules/jquery-validation/dist/localization/messages_ko.min.js"></script>
    
    <script src="../../js/jquery.cookie.js"></script>
    
<script id="trTemplatelist" type="text/x-handlebars-template">
{{#each list}}
<tr>
  <td>{{title}}</td>
  <td>{{content}}</td>
  <td>{{category}}</td>
  <td>{{deadline}}</td>
  <td>
    <button type="button" class="ok" mtnumok="{{meetingNo}}">수락</button>
    <button type="button" class="no" mtnumno="{{meetingNo}}">거절</button>
  </td>
</tr>
{{/each}}
</script>
</body>
</html>

<!-- 
  <script>
$('#photo').fileupload({
    url: '../../common/fileupload.json', // 서버에 요청할 URL
    dataType: 'json',         // 서버가 보낸 응답이 JSON임을 지정하기
    sequentialUploads: true,  // 여러 개의 파일을 업로드 할 때 순서대로 요청하기.
    singleFileUploads: false, // 한 요청에 여러 개의 파일을 전송시키기. 기본은 true.
    autoUpload: true,        // 파일을 추가할 때 자동 업로딩 여부 설정. 기본은 true.
    disableImageResize: /Android(?!.*Chrome)|Opera/
        .test(window.navigator && navigator.userAgent), // 안드로이드와 오페라 브라우저는 크기 조정 비활성 시키기
    previewMaxWidth: 800,   // 미리보기 이미지 너비
    previewMaxHeight: 800,  // 미리보기 이미지 높이 
    previewCrop: true,      // 미리보기 이미지를 출력할 때 원본에서 지정된 크기로 자르기
    done: function (e, data) { // 서버에서 응답이 오면 호출된다. 각 파일 별로 호출된다.
       $('#photo-path').val(data.result.data[0]);
    }, 
    processalways: function(e, data) {
        //console.log('fileuploadprocessalways()...', data.files.length, data.index);
        var img = $('#now-photo');
        if (data.index == 0) {
          var canvas = data.files[0].preview;
          var dataURL = canvas.toDataURL();
          img.attr('src', dataURL).css('width', '50px', 'height', '50px');
          $('#photo-label').css('display', '');
        }
    } 
});

</script>

<script>
$('#emailcheck').click(function() {
     
     var email = $("#email1").val();
     //var regex=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/;
     var regex=/^[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/;

     
      $.getJSON('../auth/checkEmail.json?email=' + $("#email1").val(), function(ajaxResult) {
        var status = ajaxResult.status;
        
        
        
        if(regex.test(email) == false) {  
            sweetAlert("경고", "이메일 형식에 맞게 입력하세요", 'warning');
            $('#isCheck').val('N');
        } 

        else if (status == "success") {
           $('#isCheck').val('Y');
           //sweetAlert("OK!", ajaxResult.data, 'success');
           swal({
                  title: "OK!",
                  text: ajaxResult.data,
                  type: "success",
                },
                function(){
                  $('#email1').focus();
                });
           //setInterval('autoRefresh_div()', 500); // 5초 후에 div 새로 고침
           //document.getElementById('email').reload();
           //$("#emaildiv").load(window.location.href+" #emaildiv");
           
        } /*else if ($("#email1").val() == '' || $("#email1").val() == 'undefined') {
          sweetAlert("경고", "이메일을 입력하세요", 'warning');
            $('#isCheck').val('N');
        }*/
        else if (status != "success") {
          sweetAlert("Fail!", ajaxResult.data, 'error');
          $('#isCheck').val('N');
          return;
        } 
      });
  });
</script>

  <script type="text/javascript">
    $( document ).ready( function () {
      
      // 이메일 정규표현식 유효성 검사
      $.validator.addMethod("emailz", function(value, element) {
         return this.optional(element) || /^[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/i.test(value);
      }, "올바른 형식의 이메일 주소를 입력하세요 ex)user01@test.com");
    
    
        
        // 이름 한글만
        $.validator.addMethod("namez", function(value, element) {
           return this.optional(element) || /^[가-힝]{2,}$/i.test(value);
        }, "한글로만 두 글자 이상 입력 하세요. ex)김구");
        
        // 암호 같은지 검사
        $.validator.addMethod("passz", function(value, element) {
          var passback = $('#passback').val();
          var password = $('#password1').val();
          
          if (passback == password) {
            return false;
          } else {
            return true;
          }
        }, "현재 사용하는 암호와 다른 암호를 입력하세요");
    
    
      
      /* 이메일 중복검사 버튼 클릭 여부 */
      jQuery.validator.addMethod("checkemail", function(value, element){
        var saveemail=$('#email1').val()
        
          if ($('#isCheck').val() == 'Y') {
              return true;
          } else if ($('#isCheck').val() == 'N') {
              return false;
          } else if(saveemail != $('#email1').val()) {
            return false;
          }; 
      }, "이메일 중복 여부를 체크하세요"); 
      
      $( "#updateform1" ).validate( {
        rules: {
          firstname1: "required",
          lastname1: "required",
          username1: {
            required: true,
            namez: true,
            minlength: 2
          },
          agree1: "required"
        },
        messages: {
          username1: {
            required: "이름을 입력하세요",
            minlength: "이름은 두 글자 이상 입력하세요"
          },
        },
        errorElement: "em",
        errorPlacement: function ( error, element ) {
          // Add the `help-block` class to the error element
          error.addClass( "help-block" );

          // Add `has-feedback` class to the parent div.form-group
          // in order to add icons to inputs
          element.parents( ".col-sm-5" ).addClass( "has-feedback" );

          if ( element.prop( "type" ) === "checkbox" ) {
            error.insertAfter( element.parent( "label" ) );
          } else {
            error.insertAfter( element );
          }

          // Add the span element, if doesn't exists, and apply the icon classes to it.
          if ( !element.next( "span" )[ 0 ] ) {
            $( "<span class='glyphicon glyphicon-remove form-control-feedback'></span>" ).insertAfter( element );
          }
        },
        success: function ( label, element ) {
          // Add the span element, if doesn't exists, and apply the icon classes to it.
          if ( !$( element ).next( "span" )[ 0 ] ) {
            $( "<span class='glyphicon glyphicon-ok form-control-feedback'></span>" ).insertAfter( $( element ) );
          }
        },
        highlight: function ( element, errorClass, validClass ) {
          $( element ).parents( ".col-sm-5" ).addClass( "has-error" ).removeClass( "has-success" );
          $( element ).next( "span" ).addClass( "glyphicon-remove" ).removeClass( "glyphicon-ok" );
        },
        unhighlight: function ( element, errorClass, validClass ) {
          $( element ).parents( ".col-sm-5" ).addClass( "has-success" ).removeClass( "has-error" );
          $( element ).next( "span" ).addClass( "glyphicon-ok" ).removeClass( "glyphicon-remove" );
        },
            submitHandler: function () {
              var param = {
                    "memberNo": $('#memberNo').val(),
                    "email": $('#email').val(),
                    "name": $('#username1').val(),
                    "photo": $('#photo-path').val()
                    //"photo": $("#photo").fadeIn("fast").attr('src',URL.createObjectURL(event.target.files[0]))
                    //"photo": $("#photo").attr('src', 'html/upload/' + val())
                
                };

                $.post('updatemember.json' , param, function(ajaxResult) {
                  if (ajaxResult.status == "fail") {
                    sweetAlert("변경 실패", ajaxResult.data, 'error');
                    return;
                  }
                  
                  swal({
                      title: "변경 완료!",
                      text: "변경을 완료하였습니다.",
                      type: "success",
                    },
                    function(){
                      event.preventDefault(); 
                      location.href='../main/main.html?ver=1';
                      });
                }, 'json'); // post();
            }
      } ); //update1
      
      
      $( "#updateform2" ).validate( {
        rules: {
              password1: {
                required: true,
                minlength: 6,
                passz: true
              },
              confirm_password1: {
                required: true,
                minlength: 6,
                equalTo: "#password1",
                passz: true
              },
              email1: {
                required: true,
                emailz: true,
                checkemail: true,
                //changeeval: true
              },
            },
            messages: {
              password1: {
                required: "암호를 입력하세요",
                minlength: "암호는 여섯 글자 이상 입력하세요"
              },
              confirm_password1: {
                required: "암호 확인란을 입력하세요",
                minlength: "암호는 여섯 글자 이상 입력하세요",
                equalTo: "암호가 맞는지  확인하세요"
              },
              email1: {
                required:"이메일을 입력하세요.",
                checkemail:"중복 여부를 체크하세요"
                //customemail:"올바른 형식의 이메일을 입력하세요.",
              }
            },
          errorElement: "em",
          errorPlacement: function ( error, element ) {
            // Add the `help-block` class to the error element
            error.addClass( "help-block" );

            // Add `has-feedback` class to the parent div.form-group
            // in order to add icons to inputs
            element.parents( ".col-sm-5" ).addClass( "has-feedback" );

            if ( element.prop( "type" ) === "checkbox" ) {
              error.insertAfter( element.parent( "label" ) );
            } else {
              error.insertAfter( element );
            }

            // Add the span element, if doesn't exists, and apply the icon classes to it.
            if ( !element.next( "span" )[ 0 ] ) {
              $( "<span class='glyphicon glyphicon-remove form-control-feedback'></span>" ).insertAfter( element );
            }
          },
          success: function ( label, element ) {
            // Add the span element, if doesn't exists, and apply the icon classes to it.
            if ( !$( element ).next( "span" )[ 0 ] ) {
              $( "<span class='glyphicon glyphicon-ok form-control-feedback'></span>" ).insertAfter( $( element ) );
            }
          },
          highlight: function ( element, errorClass, validClass ) {
            $( element ).parents( ".col-sm-5" ).addClass( "has-error" ).removeClass( "has-success" );
            $( element ).next( "span" ).addClass( "glyphicon-remove" ).removeClass( "glyphicon-ok" );
          },
          unhighlight: function ( element, errorClass, validClass ) {
            $( element ).parents( ".col-sm-5" ).addClass( "has-success" ).removeClass( "has-error" );
            $( element ).next( "span" ).addClass( "glyphicon-ok" ).removeClass( "glyphicon-remove" );
          },
              submitHandler: function () {
                var param = {
                      "memberNo": $('#memberNo').val(),
                      "email": $('#email1').val(),
                      "name": $('#nameback').val(),
                      "password": $('#password1').val(),
                      "photo": $('#pathback').val()
                  };

                  $.post('updateemailpassword.json', param, function(ajaxResult) {
                    if (ajaxResult.status == "fail") {
                      sweetAlert("변경 실패", ajaxResult.data, 'error');
                      return;
                    }
                    
                    swal({
                        title: "변경 완료!",
                        text: "변경을 완료하였습니다.",
                        type: "success",
                      },
                      function(){
                        event.preventDefault(); 
                        location.href='../main/main.html?ver=1';
                        });
                  }, 'json'); // post();
              }
        } ); //update2
        
      
      
      
    } );
  </script>

 -->
