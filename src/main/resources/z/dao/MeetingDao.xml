<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 작성: 2017-02-22 - 김재녕 -->
<!-- 내용: MeetingDao 기본 쿼리 작성 -->

<mapper namespace="z.dao.MeetingDao">

	<resultMap type="meeting" id="meeting-map">
		<id column="mtnum"			 property="meetingNo" />
		<result column="mnum"   property="meetMembNo" />
		<result column="titl" 	 property="title" />
		<result column="cont"		 property="content" />
		<result column="mtdesc"  property="category" />
		<result column="dline" 	 property="deadline" />
		<result column="photo"	 property="photo" />
		<result column="cloc"		 property="location" />
		<result column="cdate" 	 property="date" />
		<result column="ctime" 	 property="time" />
		<result column="sdate" 	 property="sdate" />
		<result column="edate" 	 property="edate" />
	</resultMap>

	<!-- 방 개설 시 기본 정보 삽입 -->
	<insert id="insertMeet" parameterType="meeting"
		useGeneratedKeys="true" keyColumn="mtnum" keyProperty="meetingNo">
		<!-- 제목(모임명), 모임설명, 이름(모임분류), 투표기한, 사진, 모임 기간 -->
		insert into meet(titl, cont, mtdesc, dline, photo)
		values(
		#{title},
		#{content},
		#{category},
		#{deadline},
		#{photo}
		)
	</insert>

	<insert id="insertTime" parameterType="meeting">
		insert into time(mtnum, sdate, edate)
		values(
		#{meetingNo},
    #{sdate},
    #{edate}
		)
	</insert>
	
	<insert id="insertLink" parameterType="meeting">
		insert into link(mnum, mtnum, boss, stat)
		values(
		#{meetMembNo},
		#{meetingNo},
		'Y',
		'N'
		)
	</insert>

	<select id="getListMeetingCards" parameterType="int" resultMap="meeting-map">
		select meet.mtnum, meet.titl, meet.cont, meet.mtdesc, meet.dline, meet.photo, meet.cloc, meet.cdate, meet.ctime from link left outer join meet on link.mtnum=meet.mtnum left outer join memb on link.mnum=memb.mnum where link.mnum=#{value};
	</select>

</mapper>